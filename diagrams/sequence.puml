@startuml

actor User
participant ESP32 as ESP32
participant "AWS IoT Core" as IoTCore
participant "Device Shadows" as Shadows
participant "Lambda Function" as Lambda
participant "DynamoDB" as DB
participant "Actuators" as Actuators

== Flujo de Sensores y Actuadores ==
ESP32 -> IoTCore : Publish Sensor Data (Temperature, Lux)
IoTCore -> Shadows : Update Device Shadows
Shadows -> Lambda : Trigger Lambda (State Change)
Lambda -> Lambda : Process Rules (Check temperature, lux)
Lambda -> IoTCore : Activate/Deactivate Actuators (Valve, Blinds)
IoTCore -> Actuators : Control Actuators (Open/Close, Activate/Deactivate)
Lambda -> DB : Store Data (Sensor and Actuator State)
DB -> Lambda : Retrieve Data (Sensor/Actuator Status)

== InteracciÃ³n de Usuario con Alexa ==
User -> Lambda : Query for Status (Temperature, Lux, Actuators)
Lambda -> IoTCore : Query Device Shadows (Get Sensor Data)
IoTCore -> Shadows : Retrieve Device State
Shadows -> Lambda : Return Device State
Lambda -> User : Return Data (Temperature, Lux, Actuator Status)

@enduml
